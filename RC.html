<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rate Card</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 引入Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a2a6c 0%, #2a4b8c 100%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: auto;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #4a6580 100%);
            color: white;
            padding: 35px 30px;
            position: relative;
        }
        
        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff7e5f, #feb47b);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }
        
        
        .header-text {
            flex: 1;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .header i {
            margin-right: 10px;
            font-size: 1.2em;
        }
        
        .search-section {
            padding: 35px;
            background: #f9fafb;
            border-bottom: 1px solid #eaecef;
        }
        
        .form-group {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .form-item {
            flex: 1;
            min-width: 280px;
            position: relative;
        }
        
        .form-item label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 15px;
        }
        
        .form-item input, 
        .form-item select {
            width: 100%;
            padding: 14px;
            border: 2px solid #dbe0e6;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
            color: #2c3e50;
        }
        
        .form-item input:focus, 
        .form-item select:focus {
            outline: none;
            border-color: #4a6580;
            box-shadow: 0 0 0 3px rgba(74, 101, 128, 0.1);
        }
        
        .search-btn {
            background: linear-gradient(135deg, #2c3e50 0%, #4a6580 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            align-self: flex-end;
            box-shadow: 0 4px 15px rgba(44, 62, 80, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(44, 62, 80, 0.3);
            background: linear-gradient(135deg, #243342 0%, #3a5675 100%);
        }
        
        .search-btn:disabled {
            background: #b0b0b0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .results-section {
            padding: 35px;
            display: none;
            overflow-x: auto;
        }
        
        .section-title {
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #4a6580;
            font-size: 1.6em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
            border-radius: 10px;
            overflow: hidden;
            min-width: 1600px;
        }
        
        .results-table th {
            background: linear-gradient(135deg, #4a6580 0%, #2c3e50 100%);
            color: white;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            font-size: 15px;
        }
        
        .results-table td {
            padding: 14px 16px;
            border-bottom: 1px solid #eaecef;
            vertical-align: top;
            color: #2c3e50;
        }
        
        .results-table tr:nth-child(even) {
            background-color: #f9fafb;
        }
        
        .results-table tr:hover {
            background-color: #edf2f7;
            transition: background-color 0.2s ease;
        }
        
        .results-info {
            background: #e6f7ff;
            color: #2c3e50;
            padding: 18px;
            border-radius: 10px;
            text-align: center;
            margin-top: 25px;
            font-weight: 600;
            font-size: 1.1em;
            border-left: 4px solid #4a6580;
        }
        
        .info-message {
            text-align: center;
            padding: 40px;
            color: #6b7280;
            font-size: 1.1em;
            background: #f9fafb;
            border-top: 1px solid #eaecef;
        }
        
        .notification {
            padding: 16px;
            margin: 16px 0;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .loading {
            text-align: center;
            padding: 30px;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4a6580;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 自动匹配框 */
        .autocomplete-container {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #dbe0e6;
            border-top: none;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-height: 220px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }
        
        .autocomplete-container.show {
            display: block;
        }
        
        .autocomplete-item {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid #eaecef;
            transition: background-color 0.2s;
            color: #2c3e50;
        }
        
        .autocomplete-item:hover {
            background-color: #edf2f7;
        }
        
        .autocomplete-item:last-child {
            border-bottom: none;
        }
        
        /* 高亮样式 */
        .highlight {
            background-color: #ffeb3b;
            font-weight: bold;
        }
        
        /* 条款复选框样式 */
        .terms-container {
            margin-top: 25px;
            padding: 20px;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #eaecef;
        }
        
        .terms-checkbox {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .terms-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #4a6580;
        }
        
        .terms-label {
            font-size: 15px;
            color: #2c3e50;
        }
        
        .terms-link {
            color: #4a6580;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s;
        }
        
        .terms-link:hover {
            color: #2c3e50;
            text-decoration: underline;
        }
        
        .search-info {
            margin-top: 20px;
            padding: 15px;
            background: #edf2f7;
            border-radius: 8px;
            font-size: 14px;
            color: #4a5568;
            border-left: 4px solid #4a6580;
        }
        
        @media (max-width: 992px) {
            .form-group {
                flex-direction: column;
                gap: 15px;
            }
            
            .form-item {
                min-width: 100%;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .header p {
                font-size: 1.1em;
            }
            
            .results-table th, .results-table td {
                padding: 12px 14px;
                font-size: 14px;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            

        }
        
        @media (max-width: 768px) {
            .container {
                border-radius: 8px;
            }
            
            .header {
                padding: 25px 20px;
            }
            
            .search-section, .results-section {
                padding: 25px 20px;
            }
            
            .search-btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        .logo-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #ff7e5f, #feb47b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        
        /* 条款弹窗样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            border-radius: 10px;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
        }
        
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
            border-radius: 5px 5px 0 0;
        }
        
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            font-size: 16px;
            font-weight: bold;
        }
        
        .tab button:hover {
            background-color: #ddd;
        }
        
        .tab button.active {
            background-color: #4a6580;
            color: white;
        }
        
        .tabcontent {
            display: none;
            padding: 20px;
            border: 1px solid #ccc;
            border-top: none;
            border-radius: 0 0 5px 5px;
        }
        
        .tabcontent.active {
            display: block;
        }
        
        .remark-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #e6f7ff;
            border-left: 4px solid #4a6580;
            border-radius: 4px;
        }
        
        .remark-section h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .remark-content {
            font-size: 14px;
            line-height: 1.5;
        }
        
        .footer-note {
            text-align: center;
            padding: 20px;
            background-color: #f9fafb;
            border-top: 1px solid #eaecef;
            font-style: italic;
            color: #6b7280;
        }
        
        /* 地图容器样式 */
        #map {
            height: 400px;
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
            display: none;
        }
        
        .map-container {
            padding: 0 35px 35px;
            display: none;
        }
        
        .map-header {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4a6580;
            font-size: 1.4em;
            font-weight: 600;
        }

        .highlight {
            background-color: #ffeb3b;
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
      <div class="header">
    <div class="header-content">
        <div class="header-text">
            <div class="logo-container">
                <div class="logo">
                    <i class="fas fa-train"></i>
                </div>
            </div>
            <h1>Rate Card</h1>
            <p><i class="fas fa-route"></i>European Railway Freight Pricing System</p>
        </div>
    </div>
</div>
        
        <div class="search-section">
            <div class="form-group">
                <div class="form-item">
                    <label><i class="fas fa-map-marker-alt"></i> From</label>
                    <input type="text" id="originInput" placeholder="Enter pickup city/terminal">
                    <div id="originAutocomplete" class="autocomplete-container"></div>
                </div>
                <div class="form-item">
                    <label><i class="fas fa-flag-checkered"></i> To</label>
                    <input type="text" id="destinationInput" placeholder="Enter delivery city/terminal">
                    <div id="destinationAutocomplete" class="autocomplete-container"></div>
                </div>
            </div>
            
            <div class="form-group">
                <div class="form-item">
                    <label><i class="fas fa-cog"></i> Service Scope</label>
                    <select id="serviceScopeSelect">
                        <option value="">All Scopes</option>
                        <option value="T-T">Terminal to Terminal (T-T)</option>
                        <option value="D-T">Door to Terminal (D-T)</option>
                        <option value="T-D">Terminal to Door (T-D)</option>
                    </select>
                </div>
                <div class="form-item">
                    <label><i class="fas fa-route"></i> Route</label>
                    <select id="routeSelect">
                        <option value="">All Routes</option>
                        <option value="Public">Public</option>
                        <option value="Super Express">Super Express</option>
                    </select>
                </div>
            </div>
            
            <div class="search-info">
                <i class="fas fa-info-circle"></i> Select origin and destination cities to search for available freight rates.
            </div>
            
            <div class="terms-container">
                <div class="terms-checkbox">
                    <input type="checkbox" id="termsCheckbox">
                    <label for="termsCheckbox" class="terms-label">
                        I have read and agree to the <a href="#" class="terms-link" id="termsLink">Terms & Conditions</a>
                    </label>
                </div>
            </div>
            
            <button class="search-btn" id="searchButton" onclick="searchProducts()" disabled>
                <i class="fas fa-search"></i> Search Rates
            </button>
        </div>
        
        <div id="notificationArea"></div>
        
        <div id="resultsSection" class="results-section">
            <h2 class="section-title">
                <i class="fas fa-list-alt"></i> Search Results
            </h2>
            <div id="remarkSection" class="remark-section" style="display: none;">
                <h3><i class="fas fa-exclamation-circle"></i> Important Remark</h3>
                <div id="remarkContent" class="remark-content"></div>
            </div>
            <div id="resultsContent">
                <!-- Results will be displayed here -->
            </div>
        </div>
        
        <!-- 地图容器 -->
        <div id="mapSection" class="map-container">
            <h3 class="map-header">
                <i class="fas fa-map-marked-alt"></i> Route Visualization
            </h3>
            <div id="map"></div>
        </div>
        
        <div class="footer-note">
            <p>If there is no route you want at this terminal, you can also consult our BD colleagues separately</p>
        </div>
        
        <div id="infoSection" class="info-message">
            <p>© European Railway Freight Pricing System. All rights reserved.</p>
        </div>
    </div>
    
    <!-- 条款弹窗 -->
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="tab">
                <button class="tablinks active" onclick="openTab(event, 'westbound')">WestBound</button>
                <button class="tablinks" onclick="openTab(event, 'eastbound')">EastBound</button>
            </div>
            
            <div id="westbound" class="tabcontent active">
                <h2>WestBound</h2>
                <h3>Limitation of Liability:</h3>
                <p>For ocean freight services, SCHENKER’s liability shall be limited on the basis of the terms of standard House Bill of Lading issued by SCHENKER, namely the relevant international conventions i.e. the Hague Rules and the Hague-Visby Rules shall be applicable, which provides that the carrier’s liability shall be limited to 666.67 Special Drawing Rights per package or unit or 2 Special Drawing Rights per kilogram of gross weight of the goods lost or damaged, whichever is the higher;</p>
                <p>For air freight services, SCHENKER’s liability shall be limited on the basis of the terms of standard House Air Waybill issued by SCHENKER, namely the relevant international conventions, i.e. the Warsaw Convention and Montreal Convention shall be applicable, which provides that the carrier’s liability shall be limited to 22 Special Drawing Rights per kilogram of weight of the goods lost or damaged;</p>
                <p>For land transportation and warehousing services, SCHENKER China’s liability shall be limited on the basis of CIFA Standard Trading Conditions, which provides that the freight forwarder’s liability shall be limited to 2 Special Drawing Rights per kilogram of gross weight of the goods lost or damaged, up to USD 50,000 per occurrence.</p>
                <p>For services other than the above, SCHENKER’s liability shall be limited to the service fee charged.</p>
                <p>By accepting this quotation, the customer acknowledges and agrees to comply with all applicable laws and regulations, including but not limited to those of the People's Republic of China, European Union. Schenker shall not be held liable for any violation or non-compliance by the customer and reserves the right to suspend provision of Services without any liability in cases where any trade restrictions apply.</p>
                
                <h3>Part A: RateCard Comments</h3>
                <ol>
                    <li>Customs Declaration in China : USD100 per declaration Sheet <covering max.5 items(Hscode); if exceeded, USD10 surcharge per every 5 items>, including general export declaration charge, customs censoring charge, document and handling fee</li>
                    <li>For Zhengzhou train, if more than 3 shippers each container , will be charged  USD 200 per extra shipper as handling charge. if HS Code is more than 13 per declaration, will be charged USD 20 per extra HS code as handling charge.</li>
                    <li>RateCard are valid for General Cargo only</li>
                    <li>In case of huge adjustment impacted on Rail Freight or Pre-carriage such as GRI, we will notify in advance .</li>
                    <li>More original city, please check with MMS China Per Request(rail.cn@dbschenker.com)</li>
                </ol>
                
                <h3>Part B: Excluding clause</h3>
                <ol>
                    <li>Container Demurrage & Detention & unloading</li>
                    <li>Pre-carriage extra cost of overload(USD250/40'/20', payload>20T)(please review with ND)</li>
                    <li>Cancellation & Rebooking for Rail</li>
                    <li>Container loading & lashing</li>
                    <li>Original Terminal Blance Adjustment or un-safe lashing Adjustment Charge at cost</li>
                    <li>Cargo insurance</li>
                    <li>Unpreditable cost such customs inspection, fumigation and others terminal handling incurred</li>
                    <li>FCR</li>
                </ol>
                
                <h3>Part C: Terms & Condition</h3>
                <ol>
                    <li>Dangerous Cargo is not accepted</li>
                    <li>Chemicals, liquid and over payload cargo need to be confirm before booking</li>
                    <li>Train Schedule provided by MMS China per month</li>
                    <li>Limit of Max cargo weight per Package/Unit/Peice :
                        <ul>
                            <li>Chongqing:Pls check with our OP collaegues if weight is more than 2 tone (per package/unit/peice).</li>
                            <li>Xi'an:for each package/unit/peice more than 100kg , will need the loading plan.</li>
                            <li>Yiwu:Weight per  package/unit/peice  ➗ bottom area (㎡) should not more than 1 , and total wieght for per Package/Unit/Peice need under 1 tone.</li>
                        </ul>
                        In case over the limitation, should provide load plan for approval before arranging booking
                    </li>
                    <li>For cargo weight/40GP/HC  > = 20 ton, must check with operation case by case.  Train ETD might be adjusted due to block train weight limit</li>
                    <li>Final interpretation is owned by each train platform</li>
                </ol>
            </div>
            
            <div id="eastbound" class="tabcontent">
                <h2>EastBound</h2>
                <h3>Limitation of Liability:</h3>
                <p>For ocean freight services, SCHENKER’s liability shall be limited on the basis of the terms of standard House Bill of Lading issued by SCHENKER, namely the relevant international conventions i.e. the Hague Rules and the Hague-Visby Rules shall be applicable, which provides that the carrier’s liability shall be limited to 666.67 Special Drawing Rights per package or unit or 2 Special Drawing Rights per kilogram of gross weight of the goods lost or damaged, whichever is the higher;</p>
                <p>For air freight services, SCHENKER’s liability shall be limited on the basis of the terms of standard House Air Waybill issued by SCHENKER, namely the relevant international conventions, i.e. the Warsaw Convention and Montreal Convention shall be applicable, which provides that the carrier’s liability shall be limited to 22 Special Drawing Rights per kilogram of weight of the goods lost or damaged;</p>
                <p>For land transportation and warehousing services, SCHENKER China’s liability shall be limited on the basis of CIFA Standard Trading Conditions, which provides that the freight forwarder’s liability shall be limited to 2 Special Drawing Rights per kilogram of gross weight of the goods lost or damaged, up to USD 50,000 per occurrence.</p>
                <p>For services other than the above, SCHENKER’s liability shall be limited to the service fee charged.</p>
                <p>By accepting this quotation, the customer acknowledges and agrees to comply with all applicable laws and regulations, including but not limited to those of the People's Republic of China, European Union. Schenker shall not be held liable for any violation or non-compliance by the customer and reserves the right to suspend provision of Services without any liability in cases where any trade restrictions apply.</p>
                
                <h3>Part A: RateCard Comments</h3>
                <ol>
                    <li>Customs Declaration in China : USD100 per declaration Sheet <covering max.5 items(Hscode); if exceeded, USD10 surcharge per every 5 items>, including general import declaration charge, customs censoring charge, document and handling fee</li>
                    <li>Commodity inspection fee: USD100 per shipment</li>
                    <li>RateCard are valid for General Cargo only</li>
                    <li>In case of huge adjustment impacted on Rail Freight or Pre-carriage such as GRI, we will notify in advance .</li>
                    <li>More original city, please check with MMS China Per Request(rail.cn@dbschenker.com)</li>
                </ol>
                
                <h3>Part B: Excluding clause</h3>
                <ol>
                    <li>Container Demurrage & Detention & unloading</li>
                    <li>On-carriage extra cost overload(USD250/40'/20', payload>20T) (please review with ND)</li>
                    <li>Cancellation & Rebooking for Rail</li>
                    <li>Container loading & lashing</li>
                    <li>Original Terminal Blance Adjustment or un-safe lashing Adjustment Charge at cost</li>
                    <li>Cargo insurance</li>
                    <li>Unpreditable cost such customs inspection, fumigation and others terminal handling incurred</li>
                    <li>FCR</li>
                </ol>
                
                <h3>Part C: Terms & Condition</h3>
                <ol>
                    <li>Dangerous Cargo is not accepted</li>
                    <li>Chemicals, liquid and over payload cargo need to be confirm before booking</li>
                    <li>Train Schedule provided by MMS China per month</li>
                    <li>Limit of Max cargo weight per Package/Unit/Peice :
                        <ul>
                            <li>Chongqing:Pls check with our OP collaegues if weight is more than 2 tone (per package/unit/peice).</li>
                            <li>Xi'an:for each package/unit/peice more than 100kg , will need the loading plan.</li>
                            <li>Yiwu:Weight per  package/unit/peice  ➗ bottom area (㎡) should not more than 1 , and total wieght for per Package/Unit/Peice need under 1 tone.</li>
                        </ul>
                        In case over the limitation, should provide load plan for approval before any  booking
                    </li>
                    <li>Final interpretation is owned by each train platform</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- 引入Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
   <script>
    // 注入的数据已在这里
    // const csvData = [ ... ];  ← 由 Python 替换注入
    const csvData = [
        
           ];

     // 获取所有城市列表
        const allCities = [
            "Ankang", "Anping", "Anqing", "Anqiu", "Anshan", "Anshun", "Anyang", "Baicheng", "Baise", "Baishan", "Baiyin", 
            "Baoding", "Baoji", "Baoying", "Bazhong", "Beihai", "Beijing", "Bengbu", "Benxi", "Bijie", "Binzhou", "Bozhou", 
            "Budapest", "Cangzhou", "Changbaishan", "Changchun", "Changde", "Changsha", "Changshu", "Changyi", "Changzhi",
            "Changzhou", "Chaohu", "Chaoshan", "Chaozhou", "Chengde", "Chengdu", "Chenzhou", "Chizhou", "Chongqing", "Chongzuo",
            "Chuzhou", "Cixi", "Dachang", "Dafeng", "Dalian", "Dandong", "Danyang", "Datong", "Dazhou", "Deyang", "Dezhou",
            "Dingxi", "Dongguan", "Dongtai", "Dongyang", "Dongying", "Duisburg", "Ezhou", "Fangchenggang", "Feicheng", "Fenghua",
            "Foshan", "Fuqing", "Fushun", "Fuxin", "Fuyang(AH)", "Fuyang(ZJ)", "Fuzhou", "Fuzhou(FJ)", "Fuzhou(JX)", "Ganzhou",
            "Gaomi", "Gaoyou", "Guangan", "Guangyuan", "Guangzhou", "Guigang", "Guilin", "Guiyang", "Haimen", "Haining", "Haiyan",
            "Haiyang", "Hamburg", "Handan", "Hangzhou", "Hanzhong", "Hebi", "Hechi", "Hefei", "Hengshui", "Hengyang", "Heyuan",
            "Heze", "Hezhou", "Huaian", "Huaibei", "Huaihua", "Huainan", "Huanggang", "Huanghua", "Huangshan", "Huangshi", "Huangyan",
            "Huizhou", "Huludao", "Huzhou", "Jian", "Jiande", "Jiangdong", "Jiangmen", "Jiangshan", "Jiangyan", "Jiangyin", "Jiaonan",
            "Jiaozhou", "Jiaozuo", "Jiaxing", "Jiayuguan", "Jieyang", "Jilin", "Jimo", "Jinan", "Jinchang", "Jincheng", "Jingdezhen",
            "Jingjiang", "Jingmen ", "Jingzhou", "Jinhua", "Jining", "Jinjiang", "Jintan", "Jinyun", "Jinzhong", "Jinzhou", "Jiujiang",
            "Jiuquan", "Jiyuan", "Jurong", "Kaifeng", "Kunshan", "Laibin", "Laiwu", "Laixi", "Laiyang", "Laizhou", "Langfang", "Lanxi",
            "Lanzhou", "Leling", "Leqing", "Leshan", "LiLing", "Lianyungang", "Liaocheng", "Liaoyang", "Liaoyuan", "Linan", "Linfen",
            "Linhai", "Linqing", "Linyi", "Lisui", "Liupanshui", "Liuzhou", "Liyang", "Longkou", "Longnan", "Longquan", "Longyan",
            "Loudi", "Luan", "Luohe", "Luoyang", "Lutai", "Luzhou", "Lvliang", "Maanshan", "Madrid", "Malaszewicze", "Maoming", "Meishan",
            "Meizhou", "Mianyang", "Nanchang", "Nanchong", "Nanjing", "Nanning", "Nanping", "Nantong", "Nanyang", "Neijiang", "Ningbo",
            "Ningde", "Ninghai", "Panan", "Panjin", "Panzhihua", "Penglai", "Pingdingshan", "Pingdong", "Pinghu", "Pingliang", "Pingxiang",
            "Pizhou", "Prague", "Putian", "Puyang", "Qidong", "Qingdao", "Qingyang", "Qingyuan", "Qingzhou", "Qinhuangdao", "Qinzhou",
            "Qixia", "Quanzhou", "Qufu", "Quzhou", "Rizhao", "Rongcheng", "Rugao", "Ruian", "Rushan", "Sanmenxia", "Sanming", "Shanghai",
            "Shangluo", "Shangqiu", "Shangrao", "Shangyu", "Shantou", "Shanwei", "Shaoguan", "Shaoxing", "Shaoyang", "Shengfang",
            "Shengzhou", "Shenyang", "Shenzhen", "Shijiazhuang", "Shiyan", "Shouguang", "Shunde", "Shuozhou", "Shuyang", "Siping", "Songyuan",
            "Suining", "Suizhou", "Suqian", "Suzhou", "Suzhou(AH)", "Suzhou(JS)", "Taian", "Taicang", "Taishan", "Taixing", "Taiyuan",
            "Taizhou(JS)", "Taizhou(ZJ)", "Tangshan", "Tengzhou", "Tianjin", "Tianmen", "Tianshui", "Tieling", "Tongchuan", "Tonghua",
            "Tongling", "Tongren", "Tongxiang", "Tongzhou", "Weifang", "Weihai", "Weinan", "Wendeng", "Wenling", "Wenzhou", "Wuhan", "Wuhu",
            "Wujiang", "Wuwei", "Wuxi", "Wuzhou", "Xi'an", "Xiamen", "Xian", "Xiangfan", "Xiangtan", "Xiangyang", "Xianning", "Xiantao",
            "Xianyang", "Xiaogan", "Xinghua", "Xingtai", "Xintai", "Xinxiang", "Xinyang", "Xinyi", "Xinyu", "Xinzhou", "Xuanchneg", "Xuchang",
            "Xuzhou", "Yaan", "Yanan", "Yancheng ", "Yangchun", "Yangjiang", "Yangquan", "Yangzhong", "Yangzhou", "Yantai", "Yanzhou", "Yibin",
            "Yichang", "Yichun", "Yingkou", "Yingtan", "Yiwu", "Yixing", "Yiyang", "Yizheng", "Yongkang", "Yongzhou", "Yucheng", "Yueyang", "Yulin",
            "Yuncheng", "Yunfu", "Yuyao", "Zaozhuang", "Zhangjiagang", "Zhangjiajie", "Zhangjiakou", "Zhangqiu", "Zhangye", "Zhangzhou", "Zhanjiang",
            "Zhaoqing", "Zhaoyang", "Zhaoyuan", "Zhengzhou", "Zhenjiang", "Zhijiang", "Zhongshan", "Zhoukou", "Zhoushan", "Zhucheng", "Zhuhai",
            "Zhuji", "Zhumadian", "Zhuozhou", "Zhuzhoiu", "Zibo", "Zigong", "Ziyang", "Zoucheng", "Zunyi", "zhuhai"
        ];

    // 条款弹窗功能 - 独立于数据
    function openTab(evt, tabName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].classList.remove("active");
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.className += " active";
    }

    // 显示通知
    function showNotification(message, type = 'success') {
        const notificationArea = document.getElementById('notificationArea');
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        notificationArea.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }

    // 提取城市函数
    function extractCities(data) {
        const cities = new Set();
        data.forEach(item => {
            if (item["From"]) cities.add(item["From"]);
            if (item["To"]) cities.add(item["To"]);
        });
        return Array.from(cities).sort();
    }

    // 防抖函数
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    // 转义HTML字符（防止XSS）
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    // 高亮显示匹配部分（修改为顺序匹配）
    function highlightText(city, val) {
        if (!val || val.length === 0) {
            return escapeHtml(city);
        }
        
        const cityLower = city.toLowerCase();
        const valLower = val.toLowerCase();
        
        // 仅高亮开头匹配的部分
        if (cityLower.startsWith(valLower)) {
            const before = city.slice(0, 0);
            const mid = city.slice(0, val.length);
            const after = city.slice(val.length);
            
            return `<strong class="highlight">${escapeHtml(mid)}</strong>${escapeHtml(after)}`;
        }
        
        return escapeHtml(city);
    }

    // 城市自动匹配功能
        function setupAutoComplete(inputId, dataList, autocompleteId) {
            const input = document.getElementById(inputId);
            const autocompleteDiv = document.getElementById(autocompleteId);
            
            const debouncedSearch = debounce(function() {
                let val = input.value.trim();
                
                // 清除之前的自动匹配结果
                autocompleteDiv.innerHTML = '';
                
                if (!val) {
                    autocompleteDiv.classList.remove('show');
                    return;
                }
                
                // 过滤匹配的城市（前缀匹配）
                const filteredCities = dataList.filter(city => 
                    city.toLowerCase().startsWith(val.toLowerCase())
                ).slice(0, 10);
                
                if (filteredCities.length > 0) {
                    // 创建匹配项
                    filteredCities.forEach(city => {
                        const item = document.createElement("div");
                        item.className = "autocomplete-item";
                        item.innerHTML = highlightText(city, val); // 修复：使用正确的函数名
                        item.addEventListener("click", function() {
                            input.value = city;
                            autocompleteDiv.classList.remove('show');
                        });
                        autocompleteDiv.appendChild(item);
                    });
                    autocompleteDiv.classList.add('show');
                } else {
                    autocompleteDiv.classList.remove('show');
                }
            }, 300);
            
            // 输入事件监听
            input.addEventListener("input", debouncedSearch);
            
            // 键盘导航
            input.addEventListener("keydown", function(e) {
                if (!autocompleteDiv.classList.contains('show')) return;
                
                const items = autocompleteDiv.getElementsByClassName("autocomplete-item");
                if (items.length === 0) return;
                
                let activeIndex = -1;
                
                // 找到当前激活的项目
                for (let i = 0; i < items.length; i++) {
                    if (items[i].classList.contains("active")) {
                        activeIndex = i;
                        break;
                    }
                }
                
                if (e.key === "ArrowDown") {
                    e.preventDefault();
                    activeIndex = (activeIndex + 1) % items.length;
                    setActiveItem(items, activeIndex);
                } else if (e.key === "ArrowUp") {
                    e.preventDefault();
                    activeIndex = activeIndex - 1 < 0 ? items.length - 1 : activeIndex - 1;
                    setActiveItem(items, activeIndex);
                } else if (e.key === "Enter") {
                    e.preventDefault();
                    if (activeIndex >= 0) {
                        items[activeIndex].click();
                    }
                }
            });
            
            // 设置激活项目
            function setActiveItem(items, index) {
                for (let i = 0; i < items.length; i++) {
                    items[i].classList.remove("active");
                }
                if (index >= 0 && index < items.length) {
                    items[index].classList.add("active");
                    items[index].scrollIntoView({ block: "nearest" });
                }
            }
            
            // 点击其他地方隐藏自动匹配
            document.addEventListener("click", function (e) {
                if (e.target !== input && !autocompleteDiv.contains(e.target)) {
                    autocompleteDiv.classList.remove('show');
                }
            });
        }

    // 地图相关变量
    let map;
    let markers = [];
    let mapInitialized = false;
    
    // 初始化地图
    function initMap() {
        if (mapInitialized) return;
        
        // 创建地图实例
        map = L.map('map').setView([51.505, -0.09], 3);
        
        // 添加地图图层
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        mapInitialized = true;
    }

    // 在地图上显示坐标
    function showCoordinatesOnMap(data) {
        // 延迟初始化地图，直到需要时才加载
        if (!mapInitialized) {
            initMap();
        }
        
        // 清除之前的标记
        markers.forEach(marker => map.removeLayer(marker));
        markers = [];
        
        // 为每个结果添加标记
        data.forEach(item => {
            const fromCity = item["From"];
            const toCity = item["To"];
            
            // 添加From城市标记（城市图标）
            if (fromCity) {
                const marker = L.marker([52.52, 13.405], { // 示例坐标
                    title: `From: ${fromCity}`,
                    icon: L.divIcon({
                        className: 'city-icon',
                        html: '<i class="fas fa-city" style="color: #4a6580; font-size: 24px;"></i>',
                        iconSize: [24, 24],
                        iconAnchor: [12, 12]
                    })
                }).addTo(map);
                markers.push(marker);
            }
            
            // 添加To城市标记（城市图标）
            if (toCity) {
                const marker = L.marker([53.5511, 9.9937], { // 示例坐标
                    title: `To: ${toCity}`,
                    icon: L.divIcon({
                        className: 'terminal-icon',
                        html: '<i class="fas fa-city" style="color: #2c3e50; font-size: 24px;"></i>',
                        iconSize: [24, 24],
                        iconAnchor: [12, 12]
                    })
                }).addTo(map);
                markers.push(marker);
            }
        });
        
        // 如果有标记，调整地图视图
        if (markers.length > 0) {
            const group = new L.featureGroup(markers);
            map.fitBounds(group.getBounds().pad(0.5));
        }
        
        // 显示地图容器
        document.getElementById('mapSection').style.display = 'block';
        document.getElementById('map').style.display = 'block';
    }

// 搜索产品功能
async function searchProducts() {
    // 检查条款是否被接受
    if (!document.getElementById('termsCheckbox').checked) {
        showNotification('Please accept the Terms & Conditions to search', 'warning');
        return;
    }
    
    const origin = document.getElementById('originInput').value.trim();
    const destination = document.getElementById('destinationInput').value.trim();
    
    const serviceScope = document.getElementById('serviceScopeSelect').value;
    const route = document.getElementById('routeSelect').value;
    
    if (!origin && !destination) {
        showNotification('Please enter origin or destination!', 'warning');
        return;
    }
    
    // 显示加载
    document.getElementById('infoSection').style.display = 'none';
    document.getElementById('resultsSection').style.display = 'block';
    
    document.getElementById('resultsContent').innerHTML = `
        <div class="loading">
            <div class="loading-spinner"></div>
            <p>Searching for available rates...</p>
        </div>
    `;
    
    try {
        // 检查数据是否存在
        if (typeof csvData === 'undefined') {
            throw new Error('Data not loaded');
        }
        
        // 使用CSV数据
        const data = csvData;
        
        // 过滤数据
        let filteredData = data;
        
        // 根据From和To字段决定搜索逻辑
        if (origin || destination) {
            // 如果同时有origin和destination
            if (origin && destination) {
                filteredData = data.filter(item => 
                    item["From"] && 
                    item["From"].toLowerCase() === origin.toLowerCase() &&
                    item["To"] && 
                    item["To"].toLowerCase() === destination.toLowerCase()
                );
            } else if (origin) {
                // 只有起点
                filteredData = data.filter(item => 
                    item["From"] && 
                    item["From"].toLowerCase() === origin.toLowerCase()
                );
            } else if (destination) {
                // 只有终点
                filteredData = data.filter(item => 
                    item["To"] && 
                    item["To"].toLowerCase() === destination.toLowerCase()
                );
            }
        }
        
        if (serviceScope && serviceScope !== "") {
            filteredData = filteredData.filter(item => 
                item["Service Scope"] === serviceScope
            );
        }
        
        if (route && route !== "") {
            filteredData = filteredData.filter(item => 
                item["Route"] === route
            );
        }
        
        if (filteredData.length === 0) {
            document.getElementById('resultsContent').innerHTML = `
                <div class="info-message">
                    <p><i class="fas fa-info-circle"></i> No records found matching your criteria</p>
                    <p style="margin-top: 10px;">Try adjusting your search parameters or contact our support team.</p>
                </div>
            `;
            showNotification('No records found', 'warning');
            return;
        }
        
        // 显示地图
        showCoordinatesOnMap(filteredData);
        
        // 生成表格HTML
        let tableHTML = `
            <table class="results-table">
                <thead>
                    <tr>
                        <th>From</th>
                        <th>To</th>
                        <th>Province</th>
                        <th>Origin Terminal</th>
                        <th>Dest Terminal</th>
                        <th>Service Scope</th>
                        <th>Route</th>
                        <th>Lead Time (Days)</th>
                        <th>Total Cost</th>
                        <th>Handling Fee</th>
                        <th>40' Payload Limited (ton)</th>
                        <th>Extra Cost of Overload</th>
                        <th>Note</th>
                        <th>Valid From</th>
                        <th>Valid To</th>
                    </tr>
                </thead>
                <tbody>
        `;
        
        filteredData.forEach(item => {
            tableHTML += `
                <tr>
                    <td>${item['From'] || 'N/A'}</td>
                    <td>${item['To'] || 'N/A'}</td>
                    <td>${item['Province'] || '-'}</td>
                    <td>${item['Origin Terminal'] || 'N/A'}</td>
                    <td>${item['Dest Terminal'] || 'N/A'}</td>
                    <td>${item['Service Scope'] || 'N/A'}</td>
                    <td>${item['Route'] || 'N/A'}</td>
                    <td>${item['Lead-Time(Day)'] || 'N/A'}</td>
                    <td>${item['Total Cost'] ? '$' + item['Total Cost'].toLocaleString() : 'N/A'}</td>
                    <td>${item['Handling Fee'] ? '$' + item['Handling Fee'].toLocaleString() : 'N/A'}</td>
                    <td>${item["40' Payload Limited (ton)"] || 'N/A'}</td>
                    <td>${item['Extra Cost of Overload']|| "-"}</td>
                    <td>${item['Note'] || '-'}</td>
                    <td>${item['Valid From'] || 'N/A'}</td>
                    <td>${item['Valid To'] || 'N/A'}</td>
                </tr>
            `;
        });
        
        tableHTML += `
                </tbody>
            </table>
        `;
        
        // 添加remark在表格下方
         const firstRemark = filteredData.find(item => item["Remark"] && item["Remark"].trim() !== "")?.["Remark"] || null;
         if (firstRemark) {
             tableHTML += `
                 <div class="remark-section" style="margin-top: 25px;">
                 <h3><i class="fas fa-exclamation-circle"></i> Important Remark</h3>
                 <div class="remark-content">${firstRemark}</div>
                 </div>
             `;  
         }

        tableHTML += `
             <div class="results-info">
                 If there is no route/price you want at this result, please contact our BD colleagues.
             </div>
         `; 
        // 显示结果
        document.getElementById('resultsContent').innerHTML = tableHTML;
        showNotification(`Found ${filteredData.length} matching records`, 'success');
        
    } catch (error) {
        document.getElementById('resultsContent').innerHTML = `
            <div class="info-message">
                <p><i class="fas fa-exclamation-triangle"></i> Error loading data</p>
                <p style="margin-top: 10px;">Please try again later or contact support if the problem persists.</p>
            </div>
        `;
        showNotification('Error loading data', 'warning');
        console.error('Search error:', error);
    }
}

    // 页面加载后初始化 - 分离UI功能和数据功能
    window.addEventListener('load', async function() {
        // 首先初始化UI组件（不依赖数据）
        try {
            // 条款复选框事件监听
            const termsCheckbox = document.getElementById('termsCheckbox');
            const searchButton = document.getElementById('searchButton');
            const modal = document.getElementById("termsModal");
            const span = document.getElementsByClassName("close")[0];
            const termsLink = document.getElementById('termsLink');
            
            // 点击条款复选框时自动弹出条款详情
            if (termsCheckbox && searchButton) {
                termsCheckbox.addEventListener('change', function() {
                    if (this.checked && modal) {
                        modal.style.display = "block";
                    }
                    searchButton.disabled = !this.checked;
                });
            }
            
            // 条款链接点击事件
            if (termsLink && modal) {
                termsLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    modal.style.display = "block";
                });
            }
            
            // 关闭弹窗
            if (span && modal) {
                span.onclick = function() {
                    modal.style.display = "none";
                }
            }
            
            if (modal) {
                window.onclick = function(event) {
                    if (event.target == modal) {
                        modal.style.display = "none";
                    }
                }
            }
        } catch (error) {
            console.error('Error initializing UI components:', error);
        }
        
        // 然后尝试初始化数据相关功能
        try {
            // 使用allCities数组而不是从空数据中提取城市
            setupAutoComplete('originInput', allCities, 'originAutocomplete');
            setupAutoComplete('destinationInput', allCities, 'destinationAutocomplete');
        } catch (error) {
            console.error('Error initializing data components:', error);
        }
    });
</script>
</body>
</html>